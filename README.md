# Цели

1. **Подготовить облачную инфраструктуру** на базе облачного провайдера Яндекс.Облако.
2. **Запустить и сконфигурировать Kubernetes кластер**.
3. **Установить и настроить систему мониторинга**.
4. **Настроить и автоматизировать сборку тестового приложения** с использованием Docker-контейнеров.
5. **Настроить CI** для автоматической сборки и тестирования.
6. **Настроить CD** для автоматического развёртывания приложения.

# Этапы выполнения


# Создание облачной инфраструктуры

Для начала необходимо подготовить облачную инфраструктуру в Яндекс.Облаке при помощи Terraform.

## Особенности выполнения:

- Бюджет купона ограничен, поэтому проектируйте инфраструктуру с учетом оптимизации ресурсов.
- Для облачного Kubernetes используйте **региональный мастер** (неотказоустойчивый).
- Для self-hosted Kubernetes минимизируйте ресурсы ВМ и долю ЦПУ.
- В обоих вариантах используйте **прерываемые ВМ** для worker nodes.

## Предварительная подготовка к установке и запуску Kubernetes кластера

1. **Создайте сервисный аккаунт**: Он будет использоваться Terraform для работы с инфраструктурой с необходимыми правами (не используйте права суперпользователя).
2. **Подготовьте backend для Terraform**:
   - **Рекомендуемый вариант**: S3 bucket в Яндекс.Облаке (создание бакета через Terraform).
   - **Альтернативный вариант**: Terraform Cloud.
3. **Создайте VPC с подсетями** в разных зонах доступности (availability zones).
4. Убедитесь, что можно выполнить команды `terraform destroy` и `terraform apply` без дополнительных ручных действий.
5. Если используется **Terraform Cloud** в качестве backend, убедитесь, что применение изменений успешно проходит через web-интерфейс Terraform Cloud.

## Ожидаемые результаты:

- Terraform сконфигурирован, и создание инфраструктуры возможно без дополнительных ручных действий.
- Полученная конфигурация инфраструктуры может корректироваться на дальнейших этапах выполнения задания.

# Описание действий

## Подготовка аккаунта и прав

### Установка Yandex CLI

Для работы с инфраструктурой необходимо установить **Yandex CLI**:

```bash
curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash
```

### Инициализация Yandex CLI

Настройка профиля CLI:

```bash
yc init
```

При инициализации потребуется ввести OAuth-токен из Яндекс ID и создать новый профиль.

### Создание сервисного аккаунта

После инициализации создайте сервисный аккаунт:

```bash
$ yc iam service-account create --name test-sa
```

### Назначение прав сервисному аккаунту

Назначьте необходимые права созданному аккаунту:

```bash
$ yc resource-manager folder add-access-binding <folder_id> --role editor --subject serviceAccount:<service_account_id>
```

### Создание ключа для Terraform

Создайте ключ доступа для Terraform:

```bash
$ yc iam key create --service-account-id <service_account_id> --output key_terraform.json
```

## Настройка Terraform backend

Для хранения состояния Terraform создайте S3 bucket либо настройте Terraform Cloud. Используйте конфигурации Terraform, находящиеся в папке `terraform_backend`.

### Инициализация Terraform

```bash
$ terraform init
```

Проверка конфигурации:

```bash
$ terraform validate
```

Создание плана развертывания:

```bash
$ terraform plan
```

Применение изменений:

```bash
$ terraform apply
```

## Создание сети VPC

Создайте виртуальную сеть (VPC) и несколько подсетей в разных зонах доступности.

### Инициализация Terraform

```bash
$ terraform init
```

Проверка конфигурации:

```bash
$ terraform validate
```

### Планирование ресурсов VPC

Создание плана развертывания сети:

```bash
$ terraform plan
```

### Применение изменений

Примените план развертывания:

```bash
$ terraform apply
```

## Запуск и тестирование команд Terraform

Запустите команды `terraform apply` и `terraform destroy`, чтобы убедиться в автоматизации создания и удаления инфраструктуры.

# Итог

В результате выполнения этого этапа была успешно создана базовая облачная инфраструктура в Яндекс.Облаке, включая сервисный аккаунт, S3 bucket для хранения состояния Terraform и сеть VPC с подсетями в разных зонах доступности. Инфраструктура готова для дальнейшей установки и настройки Kubernetes кластера, и все действия могут быть выполнены с использованием Terraform без дополнительных ручных вмешательств.


