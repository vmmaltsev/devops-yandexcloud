# Цели

1. **Подготовить облачную инфраструктуру** на базе облачного провайдера Яндекс.Облако.
2. **Запустить и сконфигурировать Kubernetes кластер**.
3. **Установить и настроить систему мониторинга**.
4. **Настроить и автоматизировать сборку тестового приложения** с использованием Docker-контейнеров.
5. **Настроить CI** для автоматической сборки и тестирования.
6. **Настроить CD** для автоматического развёртывания приложения.

# Этапы выполнения

## Создание облачной инфраструктуры
Для начала необходимо подготовить облачную инфраструктуру в Яндекс.Облаке при помощи Terraform.

### Особенности выполнения:

- Бюджет купона ограничен, что следует учитывать при проектировании инфраструктуры и использовании ресурсов.
- Для облачного Kubernetes используйте региональный мастер (неотказоустойчивый).
- Для self-hosted Kubernetes минимизируйте ресурсы ВМ и долю ЦПУ.
- В обоих вариантах используйте прерываемые ВМ для worker nodes.

## Предварительная подготовка к установке и запуску Kubernetes кластера

1. **Создайте сервисный аккаунт**, который будет использоваться Terraform для работы с инфраструктурой с необходимыми правами (не используйте права суперпользователя).
2. **Подготовьте backend для Terraform**:
   - **Рекомендуемый вариант**: S3 bucket в Яндекс.Облаке (создание бакета через Terraform).
   - **Альтернативный вариант**: Terraform Cloud.
3. **Создайте VPC с подсетями** в разных зонах доступности.
4. Убедитесь, что теперь вы можете выполнить команды `terraform destroy` и `terraform apply` без дополнительных ручных действий.
5. Если используется **Terraform Cloud** в качестве backend, убедитесь, что применение изменений успешно проходит через web-интерфейс Terraform Cloud.

## Ожидаемые результаты:

- Terraform сконфигурирован, и создание инфраструктуры возможно без дополнительных ручных действий.
- Полученная конфигурация инфраструктуры является предварительной и может изменяться в ходе дальнейшего выполнения задания.

# Описание действий

1. **Подготовка аккаунта и прав**: Создать сервисный аккаунт с правами для работы с Terraform. Проверить, что у аккаунта есть все необходимые права для управления ресурсами Яндекс.Облака, но не использовать права суперпользователя.

   Для создания сервисного аккаунта используйте инструмент командной строки Yandex CLI. Установить его можно с помощью команды:

   ```bash
   curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash

   После установки начните настройку профиля CLI с помощью команды:

   ```bash
   yc init
   
2. **Настройка Terraform backend**: Создать S3 bucket для хранения состояния Terraform либо настроить Terraform Cloud для сохранения состояния. Важно проверить, что backend корректно сохраняет состояние и обеспечивает доступ к нему.

3. **Создание сети VPC**: Создать виртуальную частную сеть (VPC) с несколькими подсетями в разных зонах доступности (availability zones). Проверить, что сеть корректно сконфигурирована и готова к использованию Kubernetes кластером.

4. **Запуск и тестирование команд Terraform**: Запустить команды `terraform apply` и `terraform destroy`, чтобы убедиться в автоматизированном создании и удалении инфраструктуры без ручных доработок. Если используется Terraform Cloud, провести проверку через его web-интерфейс.

5. **Оптимизация инфраструктуры под бюджет**: При планировании ресурсов учитывать ограничения бюджета. Для self-hosted Kubernetes использовать минимальное количество ресурсов для виртуальных машин, при этом обеспечивая их работоспособность. В обоих случаях использовать прерываемые виртуальные машины для узлов worker nodes.
